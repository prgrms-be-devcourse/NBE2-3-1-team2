<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.project01.mapper.PurchaseMapper">
    <insert id="insertOrder" parameterType="order" useGeneratedKeys="true" keyProperty="purchase.pid">
        INSERT INTO purchase (cid, ot, sst, zip, addr, st)
        VALUES (#{customer.cid}, #{purchase.ot}, #{purchase.sst}, #{customer.zip}, #{customer.addr}, #{purchase.st});
    </insert>
    <select id="selectByCustomerId" parameterType="int" resultType="purchase">
        select *
        from purchase
        where cid = #{cid}
        order by pid desc;
    </select>
    <select id="selectByDate" parameterType="purchase_date" resultType="purchase">
        select *
        from purchase
        where cid = #{cid} and ot between #{start} and #{end}
        order by pid desc;
    </select>
    <update id="updatePurchaseState" parameterType="purchase">
        UPDATE purchase
        SET ST = #{st}
        WHERE pid=#{pid} AND st = '배송 대기';
    </update>
    <update id="updatePendingPurchases">
        UPDATE purchase
        SET st = '배송 완료'
        WHERE st = '배송 대기' AND sst &lt;= now()
    </update>
</mapper>